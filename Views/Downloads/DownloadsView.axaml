<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Lattice.ViewModels"
             x:Class="Lattice.Views.Downloads.DownloadsView"
             x:DataType="vm:DownloadsViewModel">
    
    <Grid Background="{DynamicResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Padding="24,16" Background="{DynamicResource BackgroundBrush}">
            <TextBlock Text="下载中心" Classes="title" VerticalAlignment="Center"/>
        </Border>

        <!-- Category Tabs + Search -->
        <Border Grid.Row="1" Padding="24,0,24,16" Background="{DynamicResource BackgroundBrush}">
            <StackPanel Spacing="12">
                <!-- Category Tabs -->
                <TabControl SelectedIndex="{Binding SelectedCategory}" 
                           Background="Transparent" BorderThickness="0" Padding="0">
                    <TabControl.Styles>
                        <Style Selector="TabItem">
                            <Setter Property="FontSize" Value="14"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                            <Setter Property="Padding" Value="16,12"/>
                            <Setter Property="Margin" Value="0"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Background" Value="Transparent"/>
                        </Style>
                        <Style Selector="TabItem:selected">
                            <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                        </Style>
                    </TabControl.Styles>
                    <TabItem Header="核心">
                        <TextBlock Text="服务端核心下载"/>
                    </TabItem>
                    <TabItem Header="插件">
                        <TextBlock Text="插件下载"/>
                    </TabItem>
                    <TabItem Header="模组">
                        <TextBlock Text="模组下载"/>
                    </TabItem>
                </TabControl>
                
                <!-- Search Bar -->
                <Grid ColumnDefinitions="*,Auto">
                    <TextBox Text="{Binding SearchQuery}" 
                             Watermark="搜索..."
                             Classes="input" Height="40"
                             KeyDown="OnSearchKeyDown"/>
                    <Button Grid.Column="1" Command="{Binding SearchCommand}" Classes="accent"
                            Height="40" Margin="8,0,0,0">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <PathIcon Data="{StaticResource SearchIcon}" Width="16" Height="16" Foreground="White"/>
                            <TextBlock Text="搜索"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </StackPanel>
        </Border>

        <!-- Results -->
        <ScrollViewer Grid.Row="2">
            <StackPanel Margin="24" Spacing="8">
                <!-- Loading -->
                <ProgressBar IsIndeterminate="True" IsVisible="{Binding IsSearching}" Height="2"/>
                
                <!-- Error -->
                <Border Background="{DynamicResource StatusErrorBrush}" CornerRadius="8" Padding="16,12"
                        IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                    <TextBlock Text="{Binding ErrorMessage}" Foreground="White"/>
                </Border>

                <!-- Empty State -->
                <StackPanel Spacing="16" HorizontalAlignment="Center" Margin="0,48,0,0"
                            IsVisible="{Binding ShowEmptyState}">
                    <PathIcon Data="{StaticResource ArrowDownloadIcon}" Width="64" Height="64"
                              Foreground="{DynamicResource TextTertiaryBrush}" HorizontalAlignment="Center"/>
                    <TextBlock Text="输入关键词开始搜索" Classes="subtitle" HorizontalAlignment="Center"
                               Foreground="{DynamicResource TextSecondaryBrush}"/>
                </StackPanel>

                <!-- Results List -->
                <ItemsControl ItemsSource="{Binding Results}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{DynamicResource CardBrush}" CornerRadius="8" 
                                    Padding="16" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
                                    Cursor="Hand">
                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <!-- Icon -->
                                    <Border Width="48" Height="48" CornerRadius="8"
                                            Background="{DynamicResource AccentSubtleBrush}">
                                        <PathIcon Data="{StaticResource BoxIcon}" Width="24" Height="24"
                                                  Foreground="{DynamicResource AccentBrush}"/>
                                    </Border>
                                    
                                    <!-- Info -->
                                    <StackPanel Grid.Column="1" Margin="16,0,0,0" VerticalAlignment="Center" Spacing="4">
                                        <TextBlock Text="{Binding Title}" FontWeight="SemiBold"
                                                   Foreground="{DynamicResource TextPrimaryBrush}"/>
                                        <TextBlock Text="{Binding Author}" FontSize="12"
                                                   Foreground="{DynamicResource TextTertiaryBrush}"/>
                                        <TextBlock Text="{Binding Description}" FontSize="11" MaxLines="2"
                                                   TextTrimming="CharacterEllipsis"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                                    </StackPanel>
                                    
                                    <!-- Stats -->
                                    <StackPanel Grid.Column="2" VerticalAlignment="Center" Spacing="4">
                                        <TextBlock Text="{Binding Downloads, StringFormat={}{0:N0} 下载}"
                                                   FontSize="11" HorizontalAlignment="Right"
                                                   Foreground="{DynamicResource TextTertiaryBrush}"/>
                                        <Border CornerRadius="4" Padding="6,2" HorizontalAlignment="Right"
                                                Background="{DynamicResource AccentSubtleBrush}">
                                            <TextBlock Text="{Binding Source}" FontSize="10"
                                                       Foreground="{DynamicResource AccentBrush}"/>
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
