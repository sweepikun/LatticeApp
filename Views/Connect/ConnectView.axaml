<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Lattice.ViewModels"
             x:Class="Lattice.Views.Connect.ConnectView"
             x:DataType="vm:ConnectViewModel">
    
    <Grid Background="{DynamicResource BackgroundBrush}">
        <Border Width="480" Padding="40" HorizontalAlignment="Center" VerticalAlignment="Center"
                Background="{DynamicResource CardBrush}" CornerRadius="12"
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
                BoxShadow="0 8 32 0 #10000000">
            <StackPanel Spacing="24">
                <StackPanel Spacing="8" HorizontalAlignment="Center">
                    <Border Width="56" Height="56" CornerRadius="12" 
                            Background="{DynamicResource AccentBrush}"
                            HorizontalAlignment="Center">
                        <TextBlock Text="L" FontSize="28" FontWeight="Bold" 
                                   Foreground="White" HorizontalAlignment="Center" 
                                   VerticalAlignment="Center"/>
                    </Border>
                    <TextBlock Text="Connect to Server" FontSize="24" FontWeight="SemiBold"
                               HorizontalAlignment="Center" 
                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                    <TextBlock Text="Enter your server address and token" FontSize="13"
                               HorizontalAlignment="Center" 
                               Foreground="{DynamicResource TextTertiaryBrush}"/>
                </StackPanel>

                <StackPanel Spacing="12">
                    <ItemsControl ItemsSource="{Binding SavedConnections}" IsVisible="{Binding !ShowNewConnectionForm}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Command="{Binding $parent[ItemsControl].((vm:ConnectViewModel)DataContext).SelectConnectionCommand}"
                                        CommandParameter="{Binding}"
                                        Classes="lattice-ghost" Padding="12" Margin="0,4"
                                        HorizontalAlignment="Stretch">
                                    <Grid ColumnDefinitions="*,Auto" Width="400">
                                        <StackPanel Grid.Column="0" HorizontalAlignment="Left">
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold"
                                                       Foreground="{DynamicResource TextPrimaryBrush}"/>
                                            <TextBlock Text="{Binding Address}" FontSize="12"
                                                       Foreground="{DynamicResource TextTertiaryBrush}"/>
                                        </StackPanel>
                                        <TextBlock Grid.Column="1" Text="→" FontSize="16"
                                                   VerticalAlignment="Center"
                                                   Foreground="{DynamicResource TextTertiaryBrush}"/>
                                    </Grid>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <Button Content="+ New Connection" 
                            Command="{Binding ShowNewFormCommand}"
                            IsVisible="{Binding !ShowNewConnectionForm}"
                            Classes="lattice-secondary"
                            HorizontalAlignment="Stretch" HorizontalContentAlignment="Center"/>

                    <StackPanel Spacing="12" IsVisible="{Binding ShowNewConnectionForm}">
                        <TextBox Watermark="Connection Name (optional)" 
                                 Text="{Binding ConnectionName}"
                                 IsEnabled="{Binding !IsConnecting}"
                                 CornerRadius="8" Padding="14,12"/>
                        <TextBox Watermark="Server Address (e.g. http://192.168.1.100:3000)" 
                                 Text="{Binding Address}"
                                 IsEnabled="{Binding !IsConnecting}"
                                 CornerRadius="8" Padding="14,12"/>
                        <TextBox Watermark="Token" 
                                 Text="{Binding Token}"
                                 IsEnabled="{Binding !IsConnecting}"
                                 PasswordChar="●"
                                 CornerRadius="8" Padding="14,12"/>
                    </StackPanel>

                    <TextBlock Text="{Binding ErrorMessage}" 
                               Foreground="{DynamicResource StatusErrorBrush}"
                               TextWrapping="Wrap" FontSize="13"
                               IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

                    <Button Content="Connect" 
                            Command="{Binding ConnectCommand}"
                            IsEnabled="{Binding !IsConnecting}"
                            Classes="lattice-accent"
                            HorizontalAlignment="Stretch" HorizontalContentAlignment="Center"
                            Padding="16,14" Margin="0,8,0,0"/>
                </StackPanel>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
