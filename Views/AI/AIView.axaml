<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Lattice.ViewModels"
             x:Class="Lattice.Views.AI.AIView"
             x:DataType="vm:AIViewModel">
    
    <Grid Background="{DynamicResource BackgroundBrush}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Settings Panel -->
        <Border Grid.Column="0" Classes="lattice-sidebar" Padding="16">
            <StackPanel Spacing="16">
                <TextBlock Text="AI Settings" Classes="title"/>
                
                <StackPanel Spacing="8">
                    <TextBlock Text="Provider" Classes="caption"/>
                    <ComboBox ItemsSource="{Binding Providers}" 
                              SelectedItem="{Binding SelectedProvider}"
                              HorizontalAlignment="Stretch"/>
                </StackPanel>

                <StackPanel Spacing="8">
                    <TextBlock Text="API Key" Classes="caption"/>
                    <TextBox Text="{Binding ProviderKey}" 
                             PasswordChar="â€¢"
                             Watermark="Enter your API key"/>
                </StackPanel>

                <StackPanel Spacing="8">
                    <TextBlock Text="Model" Classes="caption"/>
                    <TextBox Text="{Binding SelectedModel}"
                             Watermark="e.g., gpt-4"/>
                </StackPanel>

                <Button Content="Connect" Command="{Binding ConfigureProviderCommand}"
                        Classes="lattice-accent"
                        HorizontalAlignment="Stretch"
                        IsEnabled="{Binding !IsLoading}"/>

                <TextBlock Text="{Binding ErrorMessage}" 
                           Foreground="{DynamicResource StatusErrorBrush}"
                           TextWrapping="Wrap" FontSize="12"/>

                <Border Height="1" Background="{DynamicResource DividerBrush}" Margin="0,8"/>

                <Button Content="Clear Chat" Command="{Binding ClearChatCommand}"
                        Classes="lattice-ghost" HorizontalAlignment="Stretch"/>
            </StackPanel>
        </Border>

        <!-- Chat Area -->
        <Grid Grid.Column="1" RowDefinitions="*,Auto">
            <!-- Messages -->
            <ScrollViewer Grid.Row="0" Padding="24" x:Name="ChatScrollViewer">
                <StackPanel Spacing="16">
                    <ItemsControl ItemsSource="{Binding Messages}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border CornerRadius="12" Padding="16" Margin="0,0,0,8"
                                        Background="{Binding Role, Converter={x:Static MessageRoleToBrushConverter.Instance}}">
                                    <StackPanel Spacing="8">
                                        <TextBlock Text="{Binding Role, Converter={x:Static RoleToLabelConverter.Instance}}"
                                                   FontWeight="Medium" FontSize="12"
                                                   Foreground="{DynamicResource TextTertiaryBrush}"/>
                                        <TextBlock Text="{Binding Content}" TextWrapping="Wrap"
                                                   Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <ProgressBar IsIndeterminate="True" IsVisible="{Binding IsLoading}" Height="2"/>
                </StackPanel>
            </ScrollViewer>

            <!-- Input -->
            <Border Grid.Row="1" Classes="lattice-card" BorderThickness="0,1,0,0" 
                    Padding="16" CornerRadius="0">
                <Grid ColumnDefinitions="*,Auto">
                    <TextBox Grid.Column="0" 
                             Text="{Binding InputText}"
                             Watermark="Ask about Minecraft server management..."
                             CornerRadius="8" Padding="14,12"
                             KeyDown="OnInputKeyDown"/>
                    <Button Grid.Column="1" Content="Send" 
                            Command="{Binding SendMessageCommand}"
                            Classes="lattice-accent"
                            IsEnabled="{Binding !IsLoading}"
                            Padding="20,12" Margin="12,0,0,0"/>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
